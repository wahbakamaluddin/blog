---
title: "New Free Lunch (web)"
summary:
date: 2024-11-10
series: ["CTF-Writeups"]
weight: 1
aliases: ["/01"]
tags: ["CTF-Writeups"]
author: ["Wahba Kamaluddin"]
---
> You are Chris Wong, you have a mission to win the game and redeem the free meal. Try to get over 300 score. Your flag will appears in scoreboard.php.

1. Intercept the score update HTTP POST Request:

   ![Screenshot 2024-11-10 at 08.57.06.png](images/writeups/hkcert24/NewFreeLunch(web)/Screenshot_2024-11-10_at_08.57.06.png)

   - Observe that it includes a payload with parameters `score` and `hash`.

2. Modify the Score and Resend:

   ![Screenshot 2024-11-10 at 08.58.29.png](images/writeups/hkcert24/NewFreeLunch(web)/Screenshot_2024-11-10_at_08.58.29.png)

   - Change the `score` value in the intercepted request and resend it. The server responds with "Invalid hash," it indicates that the `score` is part of the hash calculation.

3. Identify the Hashing Algorithm:

   ![Screenshot 2024-11-10 at 09.00.29.png](images/writeups/hkcert24/NewFreeLunch(web)/Screenshot_2024-11-10_at_09.00.29.png)

   - When inspecting the page, there’s a JavaScript called sha256.min.js, indicating the hash algorithm used is sha256

4. Find Hash Generation Logic:

   ![Screenshot 2024-11-10 at 09.02.56.png](images/writeups/hkcert24/NewFreeLunch(web)/Screenshot_2024-11-10_at_09.02.56.png)

   - There’s also a JavaScript code embedded on game.php page
   - Reviewing the JavaScript code, the information about the hashing can be retrieved:

     ```C
     ...

     const secretKey = '3636f69fcc3760cb130c1558ffef5e24';
     const username = "admin123";
     const token = "f980528fc2f243646fd0ea563b9b6cce";
     ...
      async function endGame() {
     						....

                 const hash = generateHash(secretKey + username + score);

                 ...
             }
     ```

     - From the code, it can be derived that the hash is generated by concatenating `secretKey`, `username`, and `score`

5. Generate the New Hash:

   ![Screenshot 2024-11-10 at 09.08.58.png](images/writeups/hkcert24/NewFreeLunch(web)/09404edb-719e-41a3-8e78-71c22e345dcd.png)

   - To modify the score, concatenate `secretKey`, `username`, and the desired score value, then hash this string with SHA-256.
   - Example input: `3636f69fcc3760cb130c1558ffef5e24admin123301`
   - Using [https://www.pelock.com/products/hash-calculator](https://www.pelock.com/products/hash-calculator), the new hash generated is: `C8B64AF8AA5E06F9BA55F7B19BCEDBDA23B11C0BBC711E5786A2B5D43CCB310F`
   - Since the server expect a lowercase hash, convert it to lowercase
     ![Screenshot 2024-11-10 at 09.11.06.png](images/writeups/hkcert24/NewFreeLunch(web)/Screenshot_2024-11-10_at_09.11.06.png)

6. Send the Modified Request with New Hash:

   ![Screenshot 2024-11-10 at 09.11.51.png](images/writeups/hkcert24/NewFreeLunch(web)/efb6421a-fc1f-4a0e-9ae5-bf8a4dd330f4.png)
